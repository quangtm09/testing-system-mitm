<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:s="http://jboss.com/products/seam/taglib"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:a="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich" template="layout/template.xhtml">

	<ui:define name="body">
		
		<s:div style="padding-top: 20px;">
			<h:outputLabel value="#{messages['candidate.search']}"
					styleClass="header-label" id="headerLabel">
					
				<rich:toolTip value="#{messages['form.header.hint']}"/>
				
				<script type="text/javascript">					
					jQuery('#headerLabel').click(function(){
						jQuery('.header-border').toggle();
					});			
				</script>	
			</h:outputLabel>	
			 
		</s:div>	
		
		<h:form id="candidateSearch" styleClass="edit" >
			<a:loadScript src="/script/utility.js" />
			
			<s:div styleClass="header-border">
				<a:keepAlive beanName="recruitRequestList" ajaxOnly="true" />
				<a:keepAlive beanName="candidateListBean" />
				<a:keepAlive beanName="candidateList" />

				<a:region renderRegionOnly="true">
					<s:decorate template="layout/display.xhtml"
						style="padding-left:3px;">
						<ui:define name="label">
							<h:outputLabel value="#{messages['com.bosch.ui.filterby']}:" />
						</ui:define>
						<h:selectOneMenu value="#{candidateListBean.searchFilterBy}" styleClass="rtsSelectOneMenu">
							<s:enumItem enumValue="CANINFO"
								label="#{messages['com.bosch.ui.caninfo']}" />
							<s:enumItem enumValue="SKILLSPEC"
								label="#{messages['com.bosch.ui.skillspec']}" />
							<a:support event="onchange" reRender="searchPanels"
								onsubmit="Richfaces.showModalPanel('ajaxLoadingModalBox',{width:50, top:200});"
								oncomplete="Richfaces.hideModalPanel('ajaxLoadingModalBox');" />
						</h:selectOneMenu>
					</s:decorate>

					<s:div id="searchPanels">
						<ui:include src="/CandidateInfoBasedSearchCriteria.xhtml" />
						<ui:include src="/CandidateSearchCriteriaSkillSpec.xhtml" />
					</s:div>
				</a:region>
			
			
			</s:div>
				
			<s:div>
				<div class="actionButtons" style="clear: both;">
					<a:commandButton id="searchButton"
						value="#{messages['Button.Search']}" 
						reRender="searchResultDiv"
						eventsQueue="search" 
						action="#{candidateHome.search()}"
						onclick="Richfaces.showModalPanel('ajaxLoadingModalBox',{width:50, top:200});"
						oncomplete="Richfaces.hideModalPanel('ajaxLoadingModalBox');"
						styleClass="submitStandard">
						<s:defaultAction />
					</a:commandButton>

					<s:button id="resetButton" action="#{candidateHome.resetSearch()}"
						value="#{messages['Button.Reset']}" 
						includePageParams="false"
						styleClass="submitStandard"
						onclick="Richfaces.showModalPanel('ajaxLoadingModalBox',{width:50, top:200});" />

					<s:button view="/CandidateCreate.xhtml"
						action="#{candidateHome.resetCandidateInstance()}"
						value="#{resource['candidate.create']}"
						rendered="#{caPrivilege.addableCandidate}" 
						propagation="join"
						styleClass="submitStandard"
						id="createButton"
						onclick="Richfaces.showModalPanel('ajaxLoadingModalBox',{width:50, top:200});">
						<rich:toolTip value="#{messages['candidate.create.tooltip']}" />
					</s:button>
					
				</div>
			</s:div>

			<s:div id="searchResultDiv" styleClass="table-align">
				<h:outputLabel value="#{messages['candidate.search.no.results']}"
					rendered="#{empty candidateHome.candidates}" />					
				<rich:dataTable id="candidateListTable" 
					var="_candidate"
					value="#{candidateHome.candidates}" 
					rowClasses="brightRow,darkRow"
					rendered="#{not empty candidateHome.candidates}" 
					rowKeyVar="index"
					width="100%" 
					reRender="candidatePaginationId"
					rows="#{messages['pagination.size']}">
					
					<rich:column styleClass="action textCenterAlign">
						<s:link id="candidateSchedule"
							view="/InterviewScheduleCreate.xhtml"
							rendered="#{schPrivilege.addableInterviewSchedule
									and (identity.hasRole('gm')
										or identity.hasRole('hr') 
										or _candidate.orgUnit.manager.usrUserName.toLowerCase(calendarBean.locale) eq credentials.username.toLowerCase(calendarBean.locale))
									and _candidate.cddStatus ne 'TECHNICAL_SCHEDULED'
									and _candidate.cddStatus ne 'TECHNICAL_PASS'}"
							propagation="end"
							onclick="Richfaces.showModalPanel('ajaxLoadingModalBox',{width:50, top:200});">
							<h:graphicImage value="/img/calendar_2.png" />
							<rich:toolTip value="#{messages['candidate.add.schedule']}" />
							<f:param name="candidateCddCandidateId"	value="#{_candidate.cddCandidateId}" />
								
						</s:link>
					</rich:column>

					<rich:column styleClass="action textCenterAlign">
						<a:commandLink id="candidateHistory"
							action="#{candidateHome.initInterviewHistories(_candidate)}"
							limitToList="true" 
							ignoreDupResponses="true" 
							ajaxSingle="true"
							onclick="Richfaces.showModalPanel('ajaxLoadingModalBox',{width:50, top:200});"
							oncomplete="Richfaces.hideModalPanel('ajaxLoadingModalBox');Richfaces.showModalPanel('candidateHistoryPanel');"
							reRender="candidateHistoryPanel"
							rendered="#{caPrivilege.viewableCandidate}">
							<h:graphicImage value="/img/candidate_history_2.png" />
							<rich:toolTip value="#{messages['candidate.view.information']}" />
						</a:commandLink>
					</rich:column>

					<rich:column styleClass="action" filterBy="#{_candidate.cddName}"
						filterEvent="onkeyup" sortBy="#{_candidate.cddName}"
						sortable="true">
						<f:facet name="header">
							<h:outputLabel value="#{messages['com.bosch.ui.name']}" />
						</f:facet>
						<s:link value="#{_candidate.cddName}"
								rendered="#{caPrivilege.editableCandidate}"
								view="#{'/CandidateEdit.xhtml'}" propagation="join"
								id="candidateEditId"
								onclick="Richfaces.showModalPanel('ajaxLoadingModalBox',{width:50, top:200});">
								<f:param name="candidateCddCandidateId"	value="#{_candidate.cddCandidateId}" />
								<f:param name="fromView" value="/CandidateList.xhtml" />
								<f:param name="rrid" 
										value="#{_candidate.recruitRequest != null 
											? _candidate.recruitRequest.rcrRecruitRequestId
											: 0}" />
								<rich:toolTip value="#{messages['candidate.edit.details']}" />
						</s:link>
						<s:link value="#{_candidate.cddName}"
								rendered="#{ (not caPrivilege.editableCandidate) and (caPrivilege.viewableCandidate)}"
								view="#{'/Candidate.xhtml'}" 
								propagation="join"
								id="candidateViewId"
								onclick="Richfaces.showModalPanel('ajaxLoadingModalBox',{width:50, top:200});">
								<f:param name="candidateCddCandidateId"	value="#{_candidate.cddCandidateId}" />
								<f:param name="fromView" value="/CandidateList.xhtml" />
								<rich:toolTip value="#{messages['candidate.view.details']}" />
						</s:link>
					</rich:column>

					<rich:column filterBy="#{_candidate.cddEmail}"
						filterEvent="onkeyup" sortBy="#{_candidate.cddEmail}"
						sortable="true">
						<f:facet name="header">
							<h:outputLabel value="#{messages['com.bosch.ui.email']}" />
						</f:facet>
						<h:outputLink value="mailto:#{_candidate.cddEmail}">
							<h:outputText value="#{_candidate.cddEmail}" />
						</h:outputLink>
					</rich:column>

					<rich:column filterBy="#{_candidate.cddPhoneNo}"
						filterEvent="onkeyup" sortBy="#{_candidate.cddPhoneNo}"
						sortable="true">
						<f:facet name="header">
							<h:outputLabel value="#{messages['com.bosch.ui.contactnumber']}" />
						</f:facet>
						<h:outputText value="#{_candidate.cddPhoneNo}" />
					</rich:column>

					<rich:column filterBy="#{_candidate.cddGraduationFaculty}"
						filterEvent="onkeyup" sortBy="#{_candidate.cddGraduationFaculty}"
						sortable="true">
						<f:facet name="header">
							<h:outputLabel value="#{messages['com.bosch.ui.faculty']}" />
						</f:facet>
						<h:outputText value="#{_candidate.cddGraduationFaculty}" />
					</rich:column>

					<rich:column
						filterBy="#{_candidate.recruitRequest.recruitRequestName}"
						filterEvent="onkeyup"
						sortBy="#{_candidate.recruitRequest.recruitRequestName}"
						sortable="true">
						<f:facet name="header">
							<h:outputLabel
								value="#{messages['com.bosch.ui.appliedforrequest']}" />
						</f:facet>
						<h:outputText
							value="#{_candidate.recruitRequest.recruitRequestName}" />
					</rich:column>

					<rich:column
						rendered="#{candidateListBean.searchFilterBy eq 'SKILLSPEC'}">
						<f:facet name="header">
							<h:outputLabel value="#{messages['com.bosch.ui.matchedskill']}" />
						</f:facet>
						<ui:param name="skillString"
							value="#{candidateListBean.getMatchedSkillString(_candidate,100)}" />
						<h:outputText value="#{stringUtil.subString(skillString,0,100)}"
							title="#{skillString}">
							<rich:toolTip followMouse="true" direction="top-right"
								showDelay="200" styleClass="tooltip" layout="block">
								<h:outputText
									value="#{candidateListBean.getMatchedSkillString(_candidate,null)}" />
							</rich:toolTip>
						</h:outputText>
					</rich:column>
					
					<rich:column filterBy="#{_candidate.cddYearOfExperience}"
						filterEvent="onkeyup" sortBy="#{_candidate.cddYearOfExperience}"
						sortable="true" styleClass="textCenterAlign">
						<f:facet name="header">
							<h:outputLabel
								value="#{messages['com.bosch.ui.overallyearofexperience']}" />
						</f:facet>
						<h:outputText value="#{_candidate.cddYearOfExperience}" />
					</rich:column>
					
					<rich:column filterBy="#{_candidate.cddRelevantExperience}"
						filterEvent="onkeyup" sortBy="#{_candidate.cddRelevantExperience}"
						sortable="true" styleClass="textCenterAlign">
						<f:facet name="header">
							<h:outputLabel
								value="#{messages['com.bosch.ui.relevantexperiences']}" />
						</f:facet>
						<h:outputText value="#{not empty _candidate.cddRelevantExperience ? _candidate.cddRelevantExperience : '0.0'}" />
					</rich:column>
					
					<rich:column filterBy="#{_candidate.cddStatus}"
						filterEvent="onkeyup" sortBy="#{_candidate.cddStatus}"
						sortable="true" styleClass="textCenterAlign">
						<f:facet name="header">
							<h:outputLabel value="#{messages['com.bosch.ui.status']}" />
						</f:facet>
						<h:outputText value="#{_candidate.cddStatus}" />
					</rich:column>

					<f:facet name="footer">
						<rich:datascroller for="candidateListTable" 
							renderIfSinglePage="false" 
							align="center"
							id="candidatePaginationId"
							maxPages="#{messages['item.pagination.size']}"/>
					</f:facet>
				</rich:dataTable>
				
				</s:div>					
				
		</h:form>
		
		<ui:include src="/CandidateHistoryPanel.xhtml" />
	</ui:define>
</ui:composition>