<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:s="http://jboss.com/products/seam/taglib"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:a="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich" template="layout/template.xhtml">

	<ui:define name="body">

		<h:form id="recruitRequestCloseForm">

			<s:div style="padding-top: 20px;">
				<h:outputLabel value="#{messages['recruit.request.assign']}"
					styleClass="header-label" />
			</s:div>

			<s:div styleClass="header-border">
				<h:panelGrid columns="2">
					<s:decorate template="layout/display.xhtml">
						<ui:define name="label">
							<h:outputLabel value="#{messages['org.unit']}:" />
						</ui:define>
						<h:outputText
							value="#{recruitRequestHome.instance.orgUnit.unitName}" />
					</s:decorate>
					<s:decorate template="layout/display.xhtml">
						<ui:define name="label">
							<h:outputLabel value="#{messages['com.bosch.ui.name']}:" />
						</ui:define>
						<h:outputText
							value="#{recruitRequestHome.instance.recruitRequestName}" />
					</s:decorate>

					<s:decorate template="layout/display.xhtml">
						<ui:define name="label">
							<h:outputLabel
								value="#{messages['recruit.request.job.position']}:" />
						</ui:define>
						<h:outputText value="#{recruitRequestHome.instance.jobPosition}" />
					</s:decorate>

					<s:decorate template="layout/display.xhtml">
						<ui:define name="label">
							<h:outputLabel value="#{messages['project.recruit.status']}:" />
						</ui:define>
						<strong style="color:#F7921E;"><h:outputText value="#{recruitRequestHome.instance.status.toString().toUpperCase()}" /></strong>
					</s:decorate>

				</h:panelGrid>

				<h:panelGrid columns="2">
					<s:decorate template="layout/display.xhtml">
						<ui:define name="label">
							<h:outputLabel value="#{messages['recruit.request.add.info']}:" />
						</ui:define>
						<h:outputText styleClass="wordWrap"
							value="#{recruitRequestHome.instance.additionalTraining}" />
					</s:decorate>
					<s:decorate template="layout/display.xhtml">
						<ui:define name="label">
							<h:outputLabel value="#{messages['recruit.request.add.skilss']}:" />
						</ui:define>
						<h:outputText styleClass="wordWrap"
							value="#{recruitRequestHome.instance.additionalSkills}" />
					</s:decorate>

					<s:decorate template="layout/display.xhtml">
						<ui:define name="label">
							<h:outputLabel value="#{messages['requested.date']}:" />
						</ui:define>
						<h:outputText value="#{recruitRequestHome.instance.requestedDate}">
							<s:convertDateTime type="both"
								pattern="#{messages['calendar.pattern']}" />
						</h:outputText>
					</s:decorate>

					<s:decorate template="layout/display.xhtml">
						<ui:define name="label">
							<h:outputLabel value="#{messages['closed.date']}:" />
						</ui:define>
						<h:outputText value="#{recruitRequestHome.instance.closedDate}">
							<s:convertDateTime type="both"
								pattern="#{messages['calendar.pattern']}" />
						</h:outputText>
					</s:decorate>

					<s:decorate template="layout/display.xhtml"
						id="rcrSkillDescriptionField">
						<ui:define name="label">
							<h:outputLabel
								value="#{messages['recruit.request.description']}:" />
						</ui:define>
						<h:outputText styleClass="wordWrap"
							value="#{recruitRequestHome.instance.description}" />
					</s:decorate>
				</h:panelGrid>


				<!--Recruitment Skills-->
				<h:panelGrid columns="2">
					<s:decorate template="layout/display.xhtml">
						<ui:define name="label">
							<h:outputLabel
								value="#{messages['recruit.request.skill.no.candidates']}:" />
						</ui:define>
						<h:outputText
							value="#{recruitRequestHome.instance.numberOfPersons}" />
					</s:decorate>
					<s:decorate template="layout/display.xhtml">
						<ui:define name="label">
							<h:outputLabel
								value="#{messages['recruit.request.skill.qualification']}:" />
						</ui:define>
						<h:outputText
							value="#{recruitRequestHome.instance.qualifications}" />
					</s:decorate>

					<s:decorate template="layout/display.xhtml">
						<ui:define name="label">
							<h:outputLabel
								value="#{messages['com.bosch.ui.yearofexperience']}:" />
						</ui:define>
						<h:outputText
							value="#{recruitRequestHome.instance.experienceYearFrom} #{' - '} #{recruitRequestHome.instance.experienceYearTo}" />
					</s:decorate>
				</h:panelGrid>

				<s:div styleClass="rts-text-align">
					<a:region rendered="#{empty recruitRequestHome.instance.recruitRequestHasSkills}">
						<h:graphicImage url="/img/msginfo.png" />
						<h:outputLabel value="#{messages['recruit.request.no.req.skills']}" />
					</a:region>	
				
					<rich:dataTable id="recruitmentRequestSkilsTable"
						value="#{recruitRequestHome.instance.recruitRequestHasSkills.toArray()}"
						rowClasses="brightRow,darkRow"
						rendered="#{not empty recruitRequestHome.instance.recruitRequestHasSkills}"
						var="item" 
						style="width:100%">

						<rich:column>
							<f:facet name="header">
								<h:outputText value="#{messages['com.bosch.ui.skillname']}" />
							</f:facet>
							<h:outputText value="#{item.skill.sklName}" style="width:70%;" />
						</rich:column>

						<rich:column styleClass="textCenterAlign">
							<f:facet name="header">
								<h:outputText
									value="#{messages['com.bosch.ui.yearofexperience']} #{' '} #{messages['int.sch.from']}" />
							</f:facet>
							<h:outputText value="#{item.rhsRequiredExperienceYearsFrom}" />
						</rich:column>

						<rich:column styleClass="textCenterAlign">
							<f:facet name="header">
								<h:outputText
									value="#{messages['com.bosch.ui.yearofexperience']} #{' '} #{messages['int.sch.to']}" />
							</f:facet>
							<h:outputText value="#{item.rhsRequiredExperienceYearsTo}" />
						</rich:column>

						<rich:column styleClass="textCenterAlign">
							<f:facet name="header">
								<h:outputText
									value="#{messages['candiadte.header.skill.level']}" />
							</f:facet>
							<h:outputText value="#{item.skillLevel}" />
						</rich:column>
					</rich:dataTable>
				</s:div>

				<!--Recruitment docs-->
				<s:div styleClass="rts-text-align">
					<a:region rendered="#{empty recruitRequestHome.instance.attachments}">
						<h:graphicImage url="/img/msginfo.png" />
						<h:outputLabel value="#{messages['recruit.request.header.no.req.doc']}" />
					</a:region>	

					<rich:dataTable id="recruitRequestDocTable" width="100%" var="_doc"
						value="#{recruitRequestHome.instance.attachments.toArray()}"
						rendered="#{not empty recruitRequestHome.instance.attachments}"
						rowClasses="brightRow,darkRow">
						<rich:column>
							<f:facet name="header">
								<h:outputLabel value="#{messages['upload.file.name']}" />
							</f:facet>
							<h:outputText value="#{_doc.attachmentName}"
								styleClass="wordWrap" />
						</rich:column>

						<rich:column styleClass="textCenterAlign">
							<f:facet name="header">
								<h:outputLabel value="#{messages['upload.file.length']}" />
							</f:facet>
							<h:outputText value="#{_doc.toString()}" />
						</rich:column>

						<rich:column styleClass="textCenterAlign">
							<f:facet name="header">
								<h:outputLabel value="#{messages['upload.uploaded.on']}" />
							</f:facet>
							<h:outputText value="#{_doc.attachmentCreatedOn}">
								<s:convertDateTime type="both"
									pattern="#{messages['calendar.pattern']}" />
							</h:outputText>
						</rich:column>

						<rich:column styleClass="textCenterAlign">
							<f:facet name="header">
								<h:outputLabel value="#{messages['upload.status']}" />
							</f:facet>
							<h:outputText value="#{_doc.attachmentStatus}" />
						</rich:column>

						<rich:column styleClass="textCenterAlign">
							<f:facet name="header">
								<h:outputLabel value="#{messages['upload.download']}" />
							</f:facet>
							<s:download src="/ResourceProvider.xhtml"
								rendered="#{(not empty _doc.attachmentName) and (not empty _doc.attachmentId)}">
								<h:graphicImage value="/img/iconDocument.gif" />
								<f:param name="attachmentId" value="#{_doc.attachmentId}" />
								<f:param name="recruitRequestId"
									value="#{recruitRequestHome.instance.rcrRecruitRequestId}" />
								<f:param name="cid"	value="#{conversation.id}" />	
							</s:download>
						</rich:column>

					</rich:dataTable>
				</s:div>
				
				<div style="clear: both">
					<span><rich:spacer height="5" /> </span>
				</div>
								
				<s:decorate	template="layout/edit.xhtml">
					<ui:define name="label">
						<h:outputLabel value="#{messages['candidate.handled.by']}:" />
					</ui:define>

					<h:inputText value="#{recruitRequestHome.instance.handledBy}"
							id="handledByTextField" binding="#{handledByTextField}"
							validator="#{candidateValidator.validateHandledBy}"
							required="true"
							requiredMessage="#{messages['error.enter.required']} #{' '} #{messages['candidate.handled.by']}">
							<s:validate/>
					</h:inputText>
					<h:outputLink value="#" id="handledByToolTip">
       					<rich:toolTip value="#{messages['candidate.look.up.tooltip.value']}" /> 
       					<rich:spacer width="5px"/>
						<h:graphicImage value="/img/iconInfo.gif" />
					</h:outputLink>
					<h:outputLink value="#" id="handledByLink">
       					<rich:toolTip value="#{messages['candidate.look.up.tooltip']}" /> 
       					<rich:spacer width="5px"/>
						<h:graphicImage value="/img/headSearch.gif" />
						<rich:componentControl for="handledByModal" attachTo="handledByLink" operation="show" event="onclick"/>
					</h:outputLink>
				</s:decorate>
				
				<h:panelGrid columns="2">
					<s:decorate template="layout/display.xhtml">
					<ui:define name="label">
						<h:outputLabel
							value="#{messages['createdBy']}:" />
					</ui:define>
					<h:outputText
						value="#{recruitRequestHome.instance.createdBy}" />
				</s:decorate>	
				
				<s:decorate template="layout/display.xhtml">
					<ui:define name="label">
						<h:outputLabel value="#{messages['createdOn']}:" />
					</ui:define>
					<h:outputText value="#{recruitRequestHome.instance.createdDate}" >
						<s:convertDateTime type="both" pattern="#{messages['calendar.pattern.long']}" locale="#{calendarBean.locale}"/>
					</h:outputText>
				</s:decorate>	
				
				<s:decorate template="layout/display.xhtml">
					<ui:define name="label">
						<h:outputLabel
							value="#{messages['updatedBy']}:" />
					</ui:define>
					<h:outputText
						value="#{recruitRequestHome.instance.updatedBy}" />
				</s:decorate>	
				
				<s:decorate template="layout/display.xhtml">
					<ui:define name="label">
						<h:outputLabel value="#{messages['updatedOn']}:" />
					</ui:define>
					<h:outputText value="#{recruitRequestHome.instance.updatedDate}" >
						<s:convertDateTime type="both" pattern="#{messages['calendar.pattern.long']}" locale="#{calendarBean.locale}"/>
					</h:outputText>
				</s:decorate>				
				
				<s:decorate	template="layout/display.xhtml" >
					<ui:define name="label">
						<h:outputLabel value="#{messages['com.bosch.ui.approved.by']}:" />
					</ui:define>

					<h:outputText value="#{recruitRequestHome.instance.approvedBy.usrFullName} - #{recruitRequestHome.instance.approvedBy.usrUserName}"/>
				</s:decorate>
				
				<s:decorate	template="layout/display.xhtml">
					<ui:define name="label">
						<h:outputLabel value="#{messages['com.bosch.ui.approved.on']}:" />
					</ui:define>

					<h:outputText value="#{recruitRequestHome.instance.approvedDate}">
						<s:convertDateTime type="both" pattern="#{messages['calendar.pattern.long']}" locale="#{calendarBean.locale}"/>
					</h:outputText>					
				</s:decorate>
						
					
				</h:panelGrid>
				
				<s:decorate	template="layout/editInterviewers.xhtml">
					<ui:define name="label">
						<h:outputLabel value="#{messages['recruit.request.send.mails.to']}:" />
					</ui:define>
				
					<h:selectManyCheckbox value="#{recruitRequestHome.selectedRecipients}"
						layout="pageDirection">
					   	<f:selectItem itemValue="2" itemLabel="HR" />
					</h:selectManyCheckbox>
				
				</s:decorate>				
				
				<div style="clear: both">
					<span><rich:spacer height="5" /> </span>
				</div>

				<s:div styleClass="bottom-border">					
						
					<h:commandButton id="saveButton" 
						styleClass="submitStandard"
						value="#{resource['recruit.request.assign']}" 
						action="#{recruitRequestHome.assignRecruitRequest()}"
						onclick="Richfaces.showModalPanel('ajaxLoadingModalBox',{width:50, top:200});">
						<s:defaultAction />
					</h:commandButton>	
						
					<s:button includePageParams="false" propagation="join"
						view="#{not empty recruitRequestHome.fromView ? recruitRequestHome.fromView : '/RecruitRequestList.xhtml'}"
						id="back" styleClass="submitStandard"
						value="#{resource['Button.Back']}"
						onclick="Richfaces.showModalPanel('ajaxLoadingModalBox',{width:50, top:200});" />	
				</s:div>
			</s:div>
		</h:form>
		<rich:modalPanel id="handledByModal" autosized="true">
	        <f:facet name="header">
	             <h:outputText value="#{resource['candidate.handledby.look.up.form']}"/>
	        </f:facet>
	        <f:facet name="controls">
	            <h:panelGroup>
	                <h:graphicImage value="/img/close.png" id="handledByHidelink" style="margin: 0px; cursor:pointer;"/>
	                <rich:componentControl for="handledByModal" attachTo="handledByHidelink" operation="hide" event="onclick" sortOrder="ASCENDING"/>
	            </h:panelGroup>
	        </f:facet>
	        <a:form ajaxSingle="true" id="handledByLookupForm" >
	        	<rich:dataTable id="userLookUpTable" 
	        		var="_ur"						
					value="#{userHome.availableUsers}"					
					width="100%"	
					rows="#{messages['item.pagination.size']}"
					rendered="#{not empty userHome.availableUsers}"
					reRender="handledByPagination"
					rowKeyVar="rowNo">
					
					<f:facet name="header">
						<rich:columnGroup>
							<rich:column>
								<h:outputText value="#{resource['form.name']}" />
							</rich:column>
							<rich:column>
								<h:outputText value="#{resource['form.username']}" />
							</rich:column>	
							<rich:column>
								<h:outputText value="#{resource['com.bosch.ui.email']}" />
							</rich:column>	
							<rich:column>
								<h:outputText value="#{resource['form.id.number']}" />
							</rich:column>								
						</rich:columnGroup>											
					</f:facet>	
					
					<rich:column filterMethod="#{handledByFilter.filterFullName}">
						<f:facet name="header">
							<h:inputText value="#{handledByFilter.filterFullNameValue}" id="handledByFullName">
								<a:support event="onkeyup" ignoreDupResponses="true" requestDelay="500"
								oncomplete="setUserToLookUpTable(event);" 
								reRender="userLookUpTable,handledByPagination"/>
							</h:inputText>
						</f:facet>
						
						<a:commandLink value="#{_ur.usrFullName}" 
								action="#{recruitRequestHome.populateUser(_ur.usrUserName)}" 
								ajaxSingle="true" 
								onclick="Richfaces.showModalPanel('ajaxLoadingModalBox')"
								oncomplete="Richfaces.hideModalPanel('handledByModal');Richfaces.hideModalPanel('ajaxLoadingModalBox');"
								reRender="handledByTextField"
								id="handledByPopup"
								process="handledByTextField">										
						</a:commandLink>		
					</rich:column>
						
					<rich:column filterMethod="#{handledByFilter.filterUsername}">
						<f:facet name="header">
							<h:inputText value="#{handledByFilter.filterUsernameValue}" id="handledByUsername">
								<a:support event="onkeyup" ignoreDupResponses="true" requestDelay="500"
								oncomplete="setUserToLookUpTable(event);" 
								reRender="userLookUpTable,handledByPagination"/>
							</h:inputText>
						</f:facet>
						<h:outputText value="#{_ur.usrUserName}" />					
					</rich:column>			
					
					<rich:column filterMethod="#{handledByFilter.filterEmail}">
						<f:facet name="header">
							<h:inputText value="#{handledByFilter.filterEmailValue}" id="inputUsrEmail">
								<a:support event="onkeyup" ignoreDupResponses="true" requestDelay="500"
								oncomplete="setUserToLookUpTable(event);" 
								reRender="userLookUpTable,handledByPagination"/>
							</h:inputText>
						</f:facet>
						<h:outputText value="#{_ur.usrEmail}" />					
					</rich:column>	
					
					<rich:column filterMethod="#{handledByFilter.filterIdNumber}">
						<f:facet name="header">
							<h:inputText value="#{handledByFilter.filterIdNumberValue}" id="handledByIdNumber">
								<a:support event="onkeyup" ignoreDupResponses="true" requestDelay="500"
								oncomplete="setUserToLookUpTable(event);" 
								reRender="userLookUpTable,handledByPagination"/>
							</h:inputText>
						</f:facet>
						<h:outputText value="#{_ur.usrIdNumber}" />					
					</rich:column>										
					
					<f:facet name="footer">
						<rich:datascroller for="userLookUpTable" 
							renderIfSinglePage="false" 
							align="center"
							id="handledByPagination"
							maxPages="#{messages['item.pagination.size']}"/>
					</f:facet>
										    
				</rich:dataTable>
				
				<rich:spacer height="5"/>			
			</a:form>
		</rich:modalPanel>
		
		<a:queue ignoreDupResponses="true" id="queue" requestDelay="100" />
	</ui:define>
</ui:composition>