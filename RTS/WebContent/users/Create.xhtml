<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:s="http://jboss.com/products/seam/taglib"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:a="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich" template="../layout/template.xhtml">

	<ui:define name="body">
		<script type="text/javascript">
			function setUserToLookUpTable(e){
				alert(e);
				var control = $((e.target ? e.target : e.srcElement).id);
				if(control.createTextRange){
					var range = control.createTextRange();
					range.collapse(false);
					range.select();
				} else if(control.setSelectionRange){
					control.focus();
					var length = control.value.length;
					control.setSelectionRange(length,length);
				}
				control.selectionStart = control.selectionEnd = control.value.length;
			}
		</script>
		
		<h:form id="userCreateForm" styleClass="edit">				
		
				<s:div style="padding-top: 20px;">
					<h:outputLabel
						value="Create User"
						styleClass="header-label" />
				</s:div>
				
					<s:div styleClass="header-border">

					<h:panelGrid columns="2">
						<h:panelGroup>
							<s:decorate id="usrUserNameField" template="../layout/edit.xhtml">
								<ui:define name="label">
									<h:outputLabel value="#{messages['form.users.username']}:" />
								</ui:define>
								<h:inputText value="#{userHome.instance.usrUserName}"
									required="true" styleClass="rtsTextBox"
									requiredMessage="#{messages['error.enter.required']} #{' '} #{messages['form.users.username']}"
									id="usrUserName">
									<a:support event="onblur" 
											ajaxSingle="true"
											reRender="usrExistUserNameInDBDeco, usrExistUserNameInBCDDeco, saveButton, synchroniseLink" 
											ignoreDupResponses="true"
											limitToList="true"
											action="#{userHome.fetchExistUserName(userHome.instance.usrUserName)}" />	
								</h:inputText>
								<h:outputLink value="#" id="handledByLinkx">
		        					<rich:toolTip value="#{messages['form.users.username.hint']}" /> 
		        					<rich:spacer width="5px"/>
									<h:graphicImage value="/img/iconInfo.gif" />
								</h:outputLink>	
								
							</s:decorate>
							
							<s:decorate id="usrExistUserNameInDBDeco">
								<s:div rendered="#{userHome.existingUserNameInDB != null}"
									id="usrExistUserNameInDBField">
									<s:decorate template="../layout/edit.xhtml">
										<ui:define name="label">
											<h:outputLabel styleClass="redText"
												value="#{messages['form.users.existing.user.name']}:">
												<rich:toolTip
													value="#{messages['form.users.existing.user.select']}" />
											</h:outputLabel>
										</ui:define>
										<s:link value="#{userHome.existingUserNameInDB.usrFullName}"
											disabled="true" styleClass="customLink"
											includePageParams="false" view="/users/Edit.xhtml" target="_blank">
											<f:param name="userUsrUserId" value="#{userHome.existingUserNameInDB.usrUserId}"/>
										</s:link>
									</s:decorate>
								</s:div>
							</s:decorate>
							
							<s:decorate id="usrExistUserNameInBCDDeco">
								<s:div rendered="#{userHome.existingUserNameInBCD == null}"
									id="usrExistUserNameInBCDField">
									<s:decorate template="../layout/edit.xhtml">
										<ui:define name="label">
											<rich:spacer/>
										</ui:define>
										<h:outputLabel styleClass="redText"
												value="#{messages['form.users.not.existing.user.name']}">
										</h:outputLabel>
									</s:decorate>
								</s:div>
							</s:decorate>
	
							<s:decorate id="usrPrefixField" template="../layout/edit.xhtml">
								<ui:define name="label">
									<h:outputLabel value="#{messages['com.bosch.ui.prefix']}:" />
								</ui:define>
								<h:selectOneMenu styleClass="rtsSelectOneMenu"
									value="#{userHome.instance.usrPrefix}" 
									required="true"
									requiredMessage="#{messages['error.select.required']} #{' '} #{messages['form.users.prefix']}">
									<f:selectItem itemValue="#{messages['prefix.mr']}" itemLabel="#{messages['prefix.mr']}" />
									<f:selectItem itemValue="#{messages['prefix.ms']}" itemLabel="#{messages['prefix.ms']}" />
								</h:selectOneMenu>
							</s:decorate>
							
							<s:decorate id="usrFullNameField" template="../layout/edit.xhtml">
								<ui:define name="label">
									<h:outputLabel value="#{messages['form.full.name']}:" />
								</ui:define>
								<h:inputText
									value="#{userHome.instance.usrFullName}"
									required="true" 
									requiredMessage="#{messages['error.enter.required']} #{' '} #{messages['form.full.name']}"
									styleClass="rtsTextBox" 
									id="usrFullName"/>								
							</s:decorate>
							
							<s:decorate id="usrStatusField" template="../layout/edit.xhtml">
								<ui:define name="label">
									<h:outputLabel value="#{messages['com.bosch.ui.status']}:" />
								</ui:define>
								<h:selectOneMenu styleClass="rtsSelectOneMenu"
									value="#{userHome.instance.status}" required="true"
									requiredMessage="#{messages['error.select.required']} #{' '} #{messages['com.bosch.ui.status']}">
									<f:selectItem itemValue="#{false}" itemLabel="#{messages['status.unActive']}" />
								</h:selectOneMenu>
							</s:decorate>
							
						</h:panelGroup>
						
						<h:panelGroup>
							<s:decorate template="../layout/edit.xhtml">
								<ui:define name="label">
									<a:commandLink value="Synchronise by Username"
										action="#{userHome.synchronization()}" 
										ajaxSingle="true" 
										onclick="Richfaces.showModalPanel('ajaxLoadingModalBox')"
										oncomplete="Richfaces.hideModalPanel('ajaxLoadingModalBox');"
										reRender="userCreateForm"
										id="synchroniseLink">	
									</a:commandLink>
								</ui:define>
									
							</s:decorate>
													
							<s:decorate id="usrIdNumberField" template="../layout/edit.xhtml">
								<ui:define name="label">
									<h:outputLabel value="#{messages['form.users.IdNumber']}:" />
								</ui:define>
								<h:inputText value="#{userHome.instance.usrIdNumber}"
									styleClass="rtsTextBox"
									id="usrUserName">
									<a:support event="onblur" 
										ajaxSingle="true"
										reRender="usrExistIdNoDeco, saveButton" 
										ignoreDupResponses="true"
										limitToList="true"
										action="#{userHome.fetchExistIdNo(userHome.instance.usrIdNumber)}" />
								</h:inputText>
								<h:outputLink value="#" id="handledByLinkx">
		        					<rich:toolTip value="#{messages['form.users.IdNumber.hint']}" /> 
		        					<rich:spacer width="5px"/>
									<h:graphicImage value="/img/iconInfo.gif" />
								</h:outputLink>
							</s:decorate>
							
							<s:decorate id="usrExistIdNoDeco">
								<s:div rendered="#{userHome.existingIdNo != null}"
									id="usrExistIdNoField">
									<s:decorate template="../layout/edit.xhtml">
										<ui:define name="label">
											<h:outputLabel styleClass="redText"
												value="#{messages['form.users.existing.user.idno']}:">
												<rich:toolTip
													value="#{messages['form.users.existing.user.select']}" />
											</h:outputLabel>
										</ui:define>
										<s:link value="#{userHome.existingIdNo.usrFullName}"
											disabled="true" styleClass="customLink"
											includePageParams="false" view="/users/Edit.xhtml" target="_blank">
											<f:param name="userUsrUserId" value="#{userHome.existingIdNo.usrUserId}"/>
											<!-- <a:support event="onclick" limitToList="true" ajaxSingle="true"
												ignoreDupResponses="true" reRender="candidateModalPanel"
												onsubmit="Richfaces.showModalPanel('ajaxLoadingModalBox',{width:50, top:200});"
												oncomplete="Richfaces.hideModalPanel('ajaxLoadingModalBox');Richfaces.showModalPanel('candidateModalPanel');">
											</a:support> -->
										</s:link>
									</s:decorate>
								</s:div>
							</s:decorate>
							
							<s:decorate id="usrEmailField" template="../layout/edit.xhtml">
								<ui:define name="label">
									<h:outputLabel value="#{messages['com.bosch.ui.email']}:" />
								</ui:define>
								<h:inputText
									value="#{userHome.instance.usrEmail}"
									required="true" 
									requiredMessage="#{messages['error.enter.required']} #{' '} #{messages['com.bosch.ui.email']}"
									styleClass="rtsTextBox"
									id="usrEmail">
									<a:support event="onblur" 
										ajaxSingle="true"
										reRender="usrExistEmailDeco, saveButton" 
										ignoreDupResponses="true"
										limitToList="true"
										action="#{userHome.fetchExistEmail(userHome.instance.usrEmail)}" />	
								</h:inputText>
							</s:decorate>
							
							<s:decorate id="usrExistEmailDeco">
								<s:div rendered="#{userHome.existingEmail != null}"
									id="usrExistEmailField">
									<s:decorate template="../layout/edit.xhtml">
										<ui:define name="label">
											<h:outputLabel styleClass="redText"
												value="#{messages['form.users.existing.user.email']}:">
												<rich:toolTip
													value="#{messages['form.users.existing.user.select']}" />
											</h:outputLabel>
										</ui:define>
										<s:link value="#{userHome.existingEmail.usrFullName}"
											disabled="true" styleClass="customLink"
											includePageParams="false" view="/users/Edit.xhtml" target="_blank">
											<f:param name="userUsrUserId" value="#{userHome.existingEmail.usrUserId}"/>
											<!-- <a:support event="onclick" limitToList="true" ajaxSingle="true"
												ignoreDupResponses="true" reRender="candidateModalPanel"
												onsubmit="Richfaces.showModalPanel('ajaxLoadingModalBox',{width:50, top:200});"
												oncomplete="Richfaces.hideModalPanel('ajaxLoadingModalBox');Richfaces.showModalPanel('candidateModalPanel');">
											</a:support> -->
										</s:link>
									</s:decorate>
								</s:div>
							</s:decorate>
							
							<s:decorate id="usrOrgUnitField" template="../layout/edit.xhtml"
								rendered="#{!candidateHome.managed}">
								<ui:define name="label">
									<h:outputLabel value="#{messages['org.unit']}:" />
								</ui:define>
								<h:selectOneMenu value="#{userHome.instance.orgUnit}"
									styleClass="rtsSelectOneMenu" required="true"
									requiredMessage="#{messages['error.select.required']} #{' '} #{messages['org.unit']}">
									<s:selectItems value="#{candidateHome.chooseAbleOrgUnitList}"
										var="_unit" label="#{_unit.unitName}">
									</s:selectItems>
									<s:convertEntity />
								</h:selectOneMenu>
							</s:decorate>	
							
							<s:decorate id="approvedByField" template="../layout/edit.xhtml">
								<ui:define name="label">
									<h:outputLabel value="#{messages['com.bosch.ui.approved.by']}:" />
								</ui:define>
								<h:selectOneMenu value="#{userHome.instance.approvedBy}"
									required="true"
									requiredMessage="#{messages['error.select.required']} #{' '} #{messages['com.bosch.ui.approved.by']}">
									<s:selectItems value="#{userHome.availableUsers}"
										noSelectionLabel="#{messages['selectOptions']}"
										var="item" 
										label="#{item.usrFullName} - #{item.usrUserName}"
										itemValue="#{item.usrUserName}" 
										itemLabel="#{item.usrUserName}">								
									</s:selectItems>
								
								</h:selectOneMenu>								
							</s:decorate>
													
						</h:panelGroup>						
	
					</h:panelGrid>
				</s:div>
	
					<div style="clear: both">
						<rich:spacer />
					</div>
	
					<s:div styleClass="bottom-border">
						<h:commandButton value="#{messages['Button.Save']}"
							action="#{userHome.createUser()}"
							styleClass="submitStandard"
							onclick="Richfaces.showModalPanel('ajaxLoadingModalBox',{width:50, top:200});"
							id="saveButton" 
							disabled="#{userHome.saveButtonStatus}">
							<s:defaultAction />
						</h:commandButton>
		
						<s:button id="resetButton" value="#{resource['Button.Reset']}"
							styleClass="submitStandard" includePageParams="none"
							onclick="Richfaces.showModalPanel('ajaxLoadingModalBox',{width:50, top:200}); resetForm();">
						</s:button>
						
						<s:button id="cancelButton" value="#{resource['Button.Cancel']}"
							styleClass="submitStandard" includePageParams="none"
							propagation="none" view="/users/List.xhtml"
							onclick="Richfaces.showModalPanel('ajaxLoadingModalBox',{width:50, top:200});">
						</s:button>		
						
					</s:div>
				
					<a:jsFunction id="resetFormJS" 
						name="resetForm" 
						ajaxSingle="true" 	
						immediate="true"	
							
						action="#{userHome.clearForm()}" 
						reRender="userCreateForm, saveButton" 
						limitToList="true" 
						requestDelay="1"
						timeout="1000"
						ignoreDupResponses="true"				
						oncomplete="Richfaces.hideModalPanel('ajaxLoadingModalBox');"/>					
				
		</h:form>

	</ui:define>

</ui:composition>
