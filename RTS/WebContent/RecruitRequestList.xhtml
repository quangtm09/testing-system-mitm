<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:s="http://jboss.com/products/seam/taglib"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:a="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich" template="layout/template.xhtml">

	<ui:define name="body">
		<style>
			.rich-filter-input {
				width: 85px;
			}
		</style>
		
		<s:div style="padding-top: 20px;">
			<h:outputLabel value="#{messages['recruit.request.search']}"
					styleClass="header-label" id="headerLabel">
					
				<rich:toolTip value="#{messages['form.header.hint']}"/>
				
				<script type="text/javascript">					
					jQuery('#headerLabel').click(function(){
						jQuery('.header-border').toggle();
					});			
				</script>	
			</h:outputLabel>	
			 
		</s:div>	
		
		<h:form styleClass="edit" id="recruitRequestForm">
		
			<s:div id="outDiv" styleClass="header-border">
				<h:panelGrid columns="2">
					<s:decorate template="layout/edit.xhtml">
						<ui:define name="label">
							<h:outputLabel value="#{messages['org.unit']}:" />
						</ui:define>

						<h:selectOneMenu value="#{recruitRequestHome.orgUnit}"
							styleClass="rtsSelectOneMenu" id="orgUnitSelect">
							<s:selectItems value="#{recruitRequestHome.orgUnits}"
								id="groupSelect" 
								var="_unit" 
								label="#{_unit.unitName}"
								noSelectionLabel="#{messages['selectOptions']}" />
							<s:convertEntity />
						</h:selectOneMenu>
					</s:decorate>

					<s:decorate template="layout/edit.xhtml" id="recruitNameField">
						<ui:define name="label">
							<h:outputLabel value="#{messages['com.bosch.ui.name']}:" />
						</ui:define>
						<h:inputText id="recruitRequestName" styleClass="rtsTextBox"
							maxlength="30" value="#{recruitRequestHome.recruitRequestName}">
							<a:support ajaxSingle="true" event="onkeyup" eventsQueue="createButton"/>
						</h:inputText>
						<rich:suggestionbox id="suggestion" style="width: 225px;"
							selectedClass="rts-entry-element" bgcolor="white" shadowDepth="0"
							for="recruitRequestName" fetchValue="#{_recruitRequestName}"
							suggestionAction="#{recruitRequestHome.autoCompleteRecruitRequests()}"
							var="_recruitRequestName" minChars="1">
							<h:column>
								<h:outputText value="#{_recruitRequestName}" />
							</h:column>
						</rich:suggestionbox>
					</s:decorate>

					<s:decorate template="layout/edit.xhtml">
						<ui:define name="label">
							<h:outputLabel value="#{messages['requested.date']}:" />
						</ui:define>
						<rich:calendar id="requestedDateCal"
							value="#{recruitRequestHome.requestedDate}"
							datePattern="#{messages['calendar.pattern']}"
							showApplyButton="false" defaultTime="00:00"
							resetTimeOnDateSelect="true" enableManualInput="false"
							monthLabels="#{messages['calendar.month.labels']}">
							<a:support ajaxSingle="true" event="onchanged"
								reRender="requestedDateCal" />
						</rich:calendar>
					</s:decorate>

					<s:decorate template="layout/edit.xhtml">
						<ui:define name="label">
							<h:outputLabel value="#{messages['closed.date']}:" />
						</ui:define>

						<rich:calendar id="closedDateCal" required="false"
							value="#{recruitRequestHome.closedDate}"
							datePattern="#{messages['calendar.pattern']}"
							showApplyButton="false" defaultTime="23:59"
							resetTimeOnDateSelect="true" enableManualInput="false"
							monthLabels="#{messages['calendar.month.labels']}">
							<a:support ajaxSingle="true" event="onchanged"
								reRender="closedDateCal" />
						</rich:calendar>
					</s:decorate>
					
					<s:decorate template="layout/edit.xhtml">
						<ui:define name="label">
							<h:outputLabel value="#{messages['project.recruit.status']}:" />
						</ui:define>
						<h:selectOneMenu value="#{recruitRequestHome.status}"
							styleClass="rtsSelectOneMenu" required="false" id="statusSelect">
							<f:selectItem itemLabel="#{messages['selectOptions']}"
								itemValue="" />
							<f:selectItem itemLabel="#{messages['status.open']}"
								itemValue="#{messages['status.open']}" />							
							<f:selectItem itemLabel="#{messages['status.approved']}"
								itemValue="#{messages['status.approved']}" />	
							<f:selectItem itemLabel="#{messages['status.rejected']}"
								itemValue="#{messages['status.rejected']}" />		
							<f:selectItem itemLabel="#{messages['status.closed']}"
								itemValue="#{messages['status.closed']}" />	
							<a:support ajaxSingle="true" event="onchange" reRender="statusSelect" />
						</h:selectOneMenu>
					</s:decorate>
					
					<s:decorate id="approvedByField" template="layout/display.xhtml">
						<ui:define name="label">
							<h:outputLabel value="#{messages['com.bosch.ui.approved.by']}:" />
						</ui:define>
						<h:selectOneMenu value="#{recruitRequestHome.approvedBy}">
							<s:selectItems value="#{userHome.availableUsers}"
								noSelectionLabel="#{messages['selectOptions']}"
								var="item" 								
								label="#{item.usrFullName} - #{item.usrUserName}">								
							</s:selectItems>
							<s:convertEntity/>
						</h:selectOneMenu>								
					</s:decorate>

					<div style="clear: both">
						<rich:spacer height="10px" />
					</div>
				</h:panelGrid>
			</s:div>
			
				<s:div>
					<a:commandButton id="Search" value="#{resource['Button.Search']}"
						action="#{recruitRequestHome.search}"
						disabled="#{!recruitRequestHome.wired}"
						onclick="Richfaces.showModalPanel('ajaxLoadingModalBox',{width:50, top:200});"
						oncomplete="Richfaces.hideModalPanel('ajaxLoadingModalBox');"
						reRender="outDiv, recruitmentDiv, messages" limitToList="true"
						styleClass="submitStandard" ajaxSingle="false">
						<s:defaultAction />
					</a:commandButton>

					<s:button value="#{resource['Button.Reset']}"
						styleClass="submitStandard" includePageParams="none"
						action="#{recruitRequestHome.resetSearch()}"
						disabled="#{!recruitRequestHome.wired}"
						onclick="Richfaces.showModalPanel('ajaxLoadingModalBox',{width:50, top:200});">
					</s:button>

					<s:button view="/RecruitRequestCreate.xhtml"
						id="createButton"
						action="#{recruitRequestHome.resetRRInstance()}"
						value="#{resource['Button.Create.Recruit.Request']}"
						propagation="join" styleClass="submitStandard"
						onclick="Richfaces.showModalPanel('ajaxLoadingModalBox',{width:50, top:200});"
						rendered="#{rrPrivilege.addableRecruitRequest}">
						<rich:toolTip value="#{messages['recruit.request.create.tooltip']}" />
					</s:button>
				</s:div>
			

			<s:div styleClass="table-align" id="recruitmentDiv">
				<a:region rendered="#{empty recruitRequestHome.recruitRequests}" >
					<h:graphicImage url="/img/msginfo.png" />
						<h:outputLabel value="#{messages['recruit.request.search.no.results']}"	/>
				</a:region>		
				
				<rich:dataTable id="recruitRequestListTable" var="rcr"
					value="#{recruitRequestHome.recruitRequests}" rowKeyVar="index"
					rowClasses="brightRow,darkRow"
					rendered="#{not empty recruitRequestHome.recruitRequests}"
					reRender="paginationId" width="100%"
					rows="#{messages['pagination.size']}">
					
					<rich:column styleClass="action textCenterAlign">
						<s:link id="approveLink"
							view="/RecruitRequestApproval.xhtml" 
							onclick="Richfaces.showModalPanel('ajaxLoadingModalBox',{width:50, top:200});"
							rendered="#{rcr.status.equalsIgnoreCase('Open') and rcr.approvedBy.usrUserName.equalsIgnoreCase(identity.username)}">
							<h:graphicImage value="img/approve.png" />
							<rich:toolTip value="#{messages['recruit.request.approve.reject']}" />
							<f:param name="recruitRequestRcrRecruitRequestId" value="#{rcr.rcrRecruitRequestId}" />
							<f:param name="fromView" value="/RecruitRequestList.xhtml" />								
						</s:link>						
					</rich:column>
					
					<rich:column styleClass="action textCenterAlign">
						<s:link id="handledByLink"
							view="/RecruitRequestHandledBy.xhtml" 
							rendered="#{((recruitRequestHome.rrCreatedBy(rcr.user.usrUserId) and rrPrivilege.viewableRecruitRequest ) or identity.hasRole('hr') )
								and not rcr.status.equalsIgnoreCase('Rejected')
								and not rcr.status.equalsIgnoreCase('Closed')}"
							onclick="Richfaces.showModalPanel('ajaxLoadingModalBox',{width:50, top:200});">
							<h:graphicImage value="img/assign.png" />
							<rich:toolTip value="#{messages['recruit.request.assign']}" />
							<f:param name="recruitRequestRcrRecruitRequestId" value="#{rcr.rcrRecruitRequestId}" />
							<f:param name="fromView" value="/RecruitRequestList.xhtml" />								
						</s:link>						
					</rich:column>
					
					<rich:column styleClass="action textCenterAlign">
						<s:link id="closeLink"
							view="/RecruitRequestClose.xhtml" 
							onclick="Richfaces.showModalPanel('ajaxLoadingModalBox',{width:50, top:200});"
							rendered="#{((recruitRequestHome.rrCreatedBy(rcr.user.usrUserId) 
								and rrPrivilege.editableRecruitRequest)
								or (identity.username.equalsIgnoreCase(rcr.handledBy) 
								and rrPrivilege.viewableRecruitRequest)) and not rcr.status.equalsIgnoreCase('Closed')}">
							<h:graphicImage value="img/no.png" />
							<rich:toolTip value="#{messages['recruit.request.close']}" />
							<f:param name="recruitRequestRcrRecruitRequestId" value="#{rcr.rcrRecruitRequestId}" />
							<f:param name="fromView" value="/RecruitRequestList.xhtml" />								
						</s:link>						
					</rich:column>

					<rich:column filterBy="#{rcr.recruitRequestName}"
						filterEvent="onkeyup" sortBy="#{rcr.recruitRequestName}"
						sortable="true"
						rendered="#{rrPrivilege.editableRecruitRequest or rrPrivilege.viewableRecruitRequest}">
						<f:facet name="header">
							<h:outputLabel value="#{messages['com.bosch.ui.name']}" />
						</f:facet>

						<s:link view="/RecruitRequestEdit.xhtml"
							value="#{rcr.recruitRequestName}" 
							propagation="join"
							rendered="#{recruitRequestHome.rrCreatedBy(rcr.user.usrUserId) 
								and rrPrivilege.editableRecruitRequest 
								and rcr.status.equalsIgnoreCase('Open')}"
							onclick="Richfaces.showModalPanel('ajaxLoadingModalBox',{width:50, top:200});">
							<rich:toolTip value="#{resource['recruit.request.edit']}" />
							<f:param name="recruitRequestRcrRecruitRequestId" value="#{rcr.rcrRecruitRequestId}" />
							<f:param name="fromView" value="/RecruitRequestList.xhtml" />
						</s:link>

						<s:link view="/RecruitRequest.xhtml"
							value="#{rcr.recruitRequestName}" propagation="join"
							rendered="#{rrPrivilege.viewableRecruitRequest 
										and ((not rrPrivilege.editableRecruitRequest) 
											or (rcr.status.equalsIgnoreCase('Closed') 
											or rcr.status.equalsIgnoreCase('Approved') 
											or rcr.status.equalsIgnoreCase('Rejected') 
											or (not recruitRequestHome.rrCreatedBy(rcr.user.usrUserId) )))}"
							onclick="Richfaces.showModalPanel('ajaxLoadingModalBox',{width:50, top:200});">
							<rich:toolTip value="#{resource['recruit.request.view']}" />
							<f:param name="recruitRequestRcrRecruitRequestId"
								value="#{rcr.rcrRecruitRequestId}" />
							<f:param name="fromView" value="/RecruitRequestList.xhtml" />
						</s:link>
					</rich:column>

					<rich:column filterBy="#{rcr.orgUnit.unitName}"
						filterEvent="onkeyup" sortBy="#{rcr.orgUnit.unitName}"
						sortable="true">
						<f:facet name="header">
							<h:outputLabel value="#{messages['org.unit']}" />
						</f:facet>
						<h:outputText value="#{rcr.orgUnit.unitName}" />
					</rich:column>

					<rich:column styleClass="textCenterAlign" sortBy="#{rcr.requestedDate}"
						sortable="true">
						<f:facet name="header">
							<h:outputLabel value="#{messages['requested.date']}" />
						</f:facet>
						<h:outputText value="#{rcr.requestedDate}">
							<s:convertDateTime type="both" pattern="#{messages['calendar.pattern']}" locale="#{calendarBean.locale}"/>
						</h:outputText>
					</rich:column>

					<rich:column styleClass="textCenterAlign" sortBy="#{rcr.closedDate}"
						sortable="true">
						<f:facet name="header">
							<h:outputText value="#{messages['closed.date']}" />
						</f:facet>
						<h:outputText value="#{rcr.closedDate}">
							<s:convertDateTime type="both"
								pattern="#{messages['calendar.pattern']}" locale="#{calendarBean.locale}"/>
						</h:outputText>
					</rich:column>
					
					<rich:column styleClass="textCenterAlign" sortBy="#{rcr.approvedBy.usrUserName}"
						sortable="true" filterBy="#{rcr.approvedBy.usrUserName}" filterEvent="onkeyup">
						<f:facet name="header">
							<h:outputLabel value="#{messages['com.bosch.ui.approved.by']}" />
						</f:facet>
						<h:outputText value="#{rcr.approvedBy.usrUserName}" >
							<s:convertDateTime type="both"
								pattern="#{messages['calendar.pattern']}" locale="#{calendarBean.locale}"/>
						</h:outputText>
					</rich:column>

					<rich:column styleClass="textCenterAlign" sortBy="#{rcr.approvedDate}"
						sortable="true">
						<f:facet name="header">
							<h:outputLabel value="#{messages['approved.reject.on']}" />
						</f:facet>
						<h:outputText value="#{rcr.approvedDate}" >
							<s:convertDateTime type="both"
								pattern="#{messages['calendar.pattern']}" locale="#{calendarBean.locale}"/>
						</h:outputText>
					</rich:column>

					<rich:column styleClass="textCenterAlign" sortBy="#{rcr.createdBy}"
						sortable="true" filterBy="#{rcr.createdBy}" filterEvent="onkeyup">
						<f:facet name="header">
							<h:outputLabel value="#{messages['recruit.request.created.by']}" />
						</f:facet>
						<h:outputText value="#{rcr.createdBy}" />
					</rich:column>
					
					<rich:column styleClass="textCenterAlign" sortBy="#{rcr.status}"
						sortable="true" filterBy="#{rcr.status}" filterEvent="onkeyup">
						<f:facet name="header">
							<h:outputLabel value="#{messages['project.recruit.status']}" />
						</f:facet>
						<h:outputText value="#{rcr.status}" />
					</rich:column>

					<f:facet name="footer">
						<rich:datascroller for="recruitRequestListTable"
							renderIfSinglePage="false" 
							align="center" 
							id="paginationId"
							maxPages="#{messages['item.pagination.size']}"/>
					</f:facet>

				</rich:dataTable>
			</s:div>
		</h:form>
		<a:queue ignoreDupResponses="true" id="queue" requestDelay="100" />
	</ui:define>
</ui:composition>